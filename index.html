<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BHET — Bharat Hardware Electricals & Tools</title>
<meta name="description" content="BHET - Tools, Electricals & Hardware. Nandura, Buldhana. WhatsApp 7768082083"/>
<link rel="manifest" href="manifest.json">
<style>
:root{--bg:#0f1720;--panel:#0b1220;--muted:#94a3b8;--accent:#16a34a}
*{box-sizing:border-box}body{margin:0;font-family:Inter,Arial,sans-serif;background:var(--bg);color:#e6f9ef}
.container{max-width:1100px;margin:0 auto;padding:14px}
header{background:var(--panel);border-bottom:1px solid #12202a;position:sticky;top:0;z-index:60}
.header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px}
.brand{display:flex;align-items:center;gap:12px}
.brand img{width:56px;height:56px;border-radius:999px}
nav{display:flex;align-items:center;gap:12px;white-space:nowrap}
nav a{color:var(--muted);margin:0 6px;padding:8px 10px;border-radius:6px;text-decoration:none;font-weight:600;cursor:pointer;white-space:nowrap}
nav a.active{background:var(--accent);color:#072f21}
.btn{background:var(--accent);color:#072f21;padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
.ghost{background:transparent;border:1px solid #203136;color:#cddcdc;padding:8px 10px;border-radius:8px;cursor:pointer}
.card{background:linear-gradient(180deg, rgba(12,18,22,0.85), rgba(6,12,14,0.75));border:1px solid #132028;padding:12px;border-radius:10px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
.imgwrap{height:180px;display:flex;align-items:center;justify-content:center;overflow:hidden;border-radius:8px;background:#06251e}
.small{color:var(--muted);font-size:13px}
.prod-title{font-weight:700;color:#dfffe8}
.prod-price{font-weight:800;color:#86efac'}
.controls{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.footer{border-top:1px solid #12202a;padding:18px 0;margin-top:20px;text-align:center;color:var(--muted)}
.modal{position:fixed;left:0;top:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:120}
.thumb{width:60px;height:60px;object-fit:cover;border-radius:6px;cursor:pointer}
.toast{position:fixed;right:16px;bottom:16px;background:#0b5941;color:#dffcea;padding:10px 14px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.6)}
.hidden{display:none}
@media(max-width:600px){.imgwrap{height:140px}nav{overflow:auto;padding:8px}}
</style>

<!-- Firebase (optional) -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, setDoc, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
import { firebaseConfig } from "./firebase/firebase-config.js";
window.__USE_FIREBASE__ = !!(firebaseConfig && firebaseConfig.projectId);

if(window.__USE_FIREBASE__){
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  window.__FB = { app, db, collection, getDocs, addDoc, setDoc, doc, onSnapshot };
  console.info('Firebase enabled: products/orders will sync with Firestore');
} else {
  console.info('Firebase not configured. Using localStorage fallback.');
}
</script>

</head>
<body>
<header>
  <div class="container header-inner">
    <div class="brand" style="display:flex;align-items:center;gap:12px">
      <img src="assets/logo/logo_option_3.png" alt="logo">
      <div style="display:flex;flex-direction:column;line-height:1">
        <div style="font-weight:800;color:#86efac">Bharat Hardware Electricals & Tools (BHET)</div>
        <div style="display:flex;gap:12px;align-items:center">
          <div class="small">Nandura, Buldhana • <a href="https://wa.me/917768082083" style="color:#86efac">7768082083</a></div>
          <div style="background:#07221a;border:1px solid #143523;padding:6px 8px;border-radius:6px;color:#a7f3d0;font-weight:700">भेट</div>
        </div>
      </div>
    </div>
    <nav id="mainNav">
      <a data-section="home" class="active">Home</a>
      <a data-section="products">Products</a>
      <a data-section="cart">Cart <span id="cartCount" style="margin-left:6px;background:#05211a;color:#86efac;padding:4px 8px;border-radius:6px">0</span></a>
      <a data-section="wishlist">Wishlist</a>
      <a data-section="contact">Contact</a>
      <a id="admin-link" style="display:none">Admin</a>
    </nav>
    <div style="display:flex;align-items:center;gap:8px">
      <button class="ghost" id="themeToggle">Dark</button>
      <button class="btn" onclick="scrollToSection('products')">Shop Now</button>
    </div>
  </div>
</header>

<main class="container" id="app">
  <section id="home" style="padding:18px 0 6px;text-align:center">
    <h1 style="font-size:28px;color:#86efac;margin-bottom:8px">Quality Tools & Electricals — Trusted by Professionals</h1>
    <p class="small">Industrial-grade power tools, electricals and hand tools. Free local support. WhatsApp: <a href="https://wa.me/917768082083" style="color:#86efac">7768082083</a></p>
  </section>

  <section style="padding:6px 0">
    <div class="card controls">
      <input id="searchInput" placeholder="Search products..." style="flex:1;padding:10px;border-radius:8px" />
      <select id="catFilter" style="padding:10px;border-radius:8px"></select>
      <select id="sortBy" style="padding:10px;border-radius:8px">
        <option value="">Sort</option><option value="price_asc">Price ↑</option><option value="price_desc">Price ↓</option><option value="new">Newest</option>
      </select>
      <input id="minP" placeholder="Min" style="width:80px;padding:8px;border-radius:6px"/>
      <input id="maxP" placeholder="Max" style="width:80px;padding:8px;border-radius:6px"/>
    </div>
  </section>

  <section id="products" style="padding:12px 0">
    <div id="productsGrid" class="grid"></div>
  </section>

  <section id="cart" style="padding:12px 0;display:none">
    <h2 style="color:#86efac">Cart</h2>
    <div id="cartView" class="card">
      <div id="cartList"></div>
      <div id="cartSummary" style="margin-top:12px"></div>
      <div style="margin-top:12px">
        <input id="coupon" placeholder="Coupon code" style="padding:8px;border-radius:6px"/>
        <button class="btn" onclick="applyCoupon()">Apply</button>
        <button class="btn" onclick="checkoutWhatsApp()" style="margin-left:8px">Checkout via WhatsApp</button>
      </div>
    </div>
  </section>

  <section id="wishlist" style="padding:12px 0;display:none">
    <h2 style="color:#86efac">Wishlist</h2>
    <div id="wishlistGrid" class="grid"></div>
  </section>

  <section id="contact" style="padding:12px 0;display:none">
    <h2 style="color:#86efac">Contact</h2>
    <div class="card">
      <textarea id="enquiry" placeholder="Write enquiry..." style="width:100%;height:120px;padding:8px;border-radius:6px"></textarea>
      <div style="margin-top:8px"><button class="btn" onclick="sendEnquiry()">Send via WhatsApp</button></div>
    </div>
  </section>

</main>
<footer class="footer">© 2025 BHET — Bharat Hardware Electricals & Tools | 7768082083</footer>

<!-- Product Modal -->
<div id="modal" class="modal">
  <div class="panel card" style="max-width:1000px;width:95%;padding:18px">
    <button class="ghost" onclick="closeModal()" style="float:right">Close</button>
    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <div style="flex:1 1 360px">
        <img id="mainImg" src="" style="width:100%;max-height:420px;object-fit:contain;background:#07121a;padding:6px;border-radius:8px"/>
        <div id="thumbs" style="display:flex;gap:8px;margin-top:8px"></div>
      </div>
      <div style="flex:1 1 320px">
        <h3 id="mTitle"></h3>
        <div id="mCat" class="small"></div>
        <div id="mPrice" style="margin-top:8px" class="prod-price"></div>
        <div id="mStock" class="small" style="margin-top:6px"></div>
        <p id="mDesc" class="small" style="margin-top:8px"></p>
        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <div id="variantArea"></div>
          <div style="display:flex;align-items:center;gap:6px">
            <button class="btn" id="addCartBtn">Add to cart</button>
            <button class="ghost" id="wishBtn">♡ Wishlist</button>
          </div>
        </div>
        <hr style="margin:12px 0">
        <div>
          <h4 style="margin:6px 0">Reviews</h4>
          <div id="reviewsList"></div>
          <div style="margin-top:8px">
            <textarea id="reviewText" placeholder="Write review..." style="width:100%;height:80px;padding:8px;border-radius:6px"></textarea>
            <input id="reviewFile" type="file" accept="image/*"/>
            <div style="margin-top:8px"><button class="btn" onclick="submitReview()">Submit Review</button></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Login Modal (hidden) -->
<div id="admin-login" class="modal">
  <div class="panel card" style="max-width:360px">
    <h3 style="color:#86efac">Admin Login</h3>
    <input id="adminId" placeholder="Admin ID" style="width:100%;padding:10px;border-radius:6px"/>
    <input id="adminPass" placeholder="Password" type="password" style="width:100%;padding:10px;border-radius:6px;margin-top:8px"/>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn" onclick="doAdminLogin()">Login</button>
      <button class="ghost" onclick="closeAdminLogin()">Cancel</button>
    </div>
    <div class="small" style="margin-top:8px;color:#94a3b8">Press <strong>Shift + A</strong> to open this login anywhere.</div>
  </div>
</div>

<!-- Change Password Modal (admin only) -->
<div id="changePassBox" class="modal">
  <div class="panel card" style="max-width:360px">
    <h3 style="color:#86efac">Change Admin Password</h3>
    <input id="oldPass" type="password" placeholder="Old Password" style="width:100%;padding:10px;border-radius:6px;margin-top:8px"/>
    <input id="newPass" type="password" placeholder="New Password" style="width:100%;padding:10px;border-radius:6px;margin-top:8px"/>
    <input id="confirmPass" type="password" placeholder="Confirm New Password" style="width:100%;padding:10px;border-radius:6px;margin-top:8px"/>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button class="btn" onclick="changeAdminPassword()">Update Password</button>
      <button class="ghost" onclick="closeChangePass()">Cancel</button>
    </div>
  </div>
</div>

<div id="toastArea"></div>

<script>
/* ------------ Data & State ------------ */
var PRODUCTS = JSON.parse(localStorage.getItem('BHET_products')||'null') || (function(){ var arr=[]; for(var i=1;i<=30;i++){ arr.push({id:i,title:'Product '+i,cat:i%3?['Hand Tools','Power Tools','Electricals'][i%3]: 'Hand Tools',price:499+i*200,desc:'Quality product '+i,stock:5+(i%7),imgs:['assets/product_'+i+'.png'],variants:[{name:'Default',price:499+i*200,stock:5+(i%7)}],created:Date.now()-i*100000}); } localStorage.setItem('BHET_products', JSON.stringify(arr)); return arr; })();
var CART = JSON.parse(localStorage.getItem('BHET_cart')||'[]');
var WISHLIST = JSON.parse(localStorage.getItem('BHET_wishlist')||'[]');
var COUPONS = JSON.parse(localStorage.getItem('bhet_coupons')||'[]');
var REVIEWS = JSON.parse(localStorage.getItem('bhet_reviews')||'{}');
var APPLIED = null;

/* ------------ Helpers ------------ */
function saveAll(){ localStorage.setItem('BHET_products', JSON.stringify(PRODUCTS)); localStorage.setItem('BHET_cart', JSON.stringify(CART)); localStorage.setItem('BHET_wishlist', JSON.stringify(WISHLIST)); localStorage.setItem('bhet_coupons', JSON.stringify(COUPONS)); localStorage.setItem('bhet_reviews', JSON.stringify(REVIEWS)); updateCounts(); }
function toast(msg){ var t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),2500); }
function updateCounts(){ document.getElementById('cartCount').innerText = CART.reduce((s,i)=>s+i.qty,0); }
function scrollToSection(id){ document.querySelectorAll('main>section').forEach(s=>s.style.display='none'); document.getElementById(id).style.display='block'; document.querySelectorAll('#mainNav a').forEach(a=>a.classList.remove('active')); var el = Array.from(document.querySelectorAll('#mainNav a')).find(x=>x.getAttribute('data-section')===id); if(el) el.classList.add('active'); if(id==='products'){ renderProducts(); } if(id==='cart'){ renderCart(); } if(id==='wishlist'){ renderWishlist(); } }

/* init nav */
document.querySelectorAll('#mainNav a').forEach(a=>{ a.addEventListener('click', ()=>{ var s = a.getAttribute('data-section'); if(s) scrollToSection(s); }); });

/* search debounce */
var debounceTimer=null; document.getElementById('searchInput').addEventListener('input', ()=>{ clearTimeout(debounceTimer); debounceTimer=setTimeout(renderProducts,250); });

/* populate categories */
function populateCats(){ var cats = Array.from(new Set(PRODUCTS.map(p=>p.cat))); var sel=document.getElementById('catFilter'); sel.innerHTML='<option value=\"\">All Categories</option>'; cats.forEach(c=>{ var o=document.createElement('option'); o.value=c; o.textContent=c; sel.appendChild(o); }); }
document.getElementById('catFilter').addEventListener('change', renderProducts); document.getElementById('sortBy').addEventListener('change', renderProducts);

/* render products */
function renderProducts(){
  var grid = document.getElementById('productsGrid'); grid.innerHTML='';
  var term = (document.getElementById('searchInput').value||'').toLowerCase();
  var cat = document.getElementById('catFilter').value;
  var minP = parseFloat(document.getElementById('minP').value)||0;
  var maxP = parseFloat(document.getElementById('maxP').value)||Infinity;
  var sort = document.getElementById('sortBy').value;
  var list = PRODUCTS.filter(p=> (p.title.toLowerCase().includes(term) || p.desc.toLowerCase().includes(term)) && (!cat || p.cat===cat) && p.price>=minP && p.price<=maxP );
  if(sort==='price_asc') list.sort((a,b)=>a.price-b.price);
  if(sort==='price_desc') list.sort((a,b)=>b.price-a.price);
  if(sort==='new') list.sort((a,b)=>b.created-b.created);
  list.forEach(p=>{
    var d=document.createElement('div'); d.className='card';
    d.innerHTML = `<div class="imgwrap"><img src="${p.imgs[0]}" style="width:100%;height:100%;object-fit:cover"/></div>
      <div style="margin-top:8px"><div class="prod-title">${p.title}</div><div class="small">${p.cat}</div></div>
      <div style="margin-top:6px" class="small">${p.desc}</div>
      <div style="margin-top:8px" class="prod-price">₹${p.price}</div>
      <div style="margin-top:8px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
        <button class="btn" onclick="openModal(${p.id})">View</button>
        <button class="ghost" onclick="quickAdd(${p.id})">Add</button>
        <button class="ghost" onclick="toggleWish(${p.id})">♡</button>
        <div style="margin-left:auto" class="small">${p.stock>5? 'In Stock': (p.stock>0? 'Low Stock':'Out of Stock')}</div>
      </div>`;
    grid.appendChild(d);
  });
}

/* modal, cart, wishlist, reviews, coupons, admin login, password change, logout etc. */
var currentProduct = null;
function openModal(id){
  var p = PRODUCTS.find(x=>x.id===id); if(!p) return;
  currentProduct = p;
  document.getElementById('mainImg').src = p.imgs[0];
  document.getElementById('mTitle').innerText = p.title;
  document.getElementById('mCat').innerText = p.cat;
  document.getElementById('mPrice').innerText = '₹'+p.price;
  document.getElementById('mStock').innerText = p.stock>0?('In stock: '+p.stock):'Out of stock';
  document.getElementById('mDesc').innerText = p.desc;
  document.getElementById('addCartBtn').onclick = ()=>{ addToCart(p.id); };
  document.getElementById('wishBtn').onclick = ()=>{ toggleWish(p.id); };
  var thumbs = document.getElementById('thumbs'); thumbs.innerHTML='';
  p.imgs.forEach(src=>{ var t=document.createElement('img'); t.src=src; t.className='thumb'; t.onclick=()=>document.getElementById('mainImg').src=src; thumbs.appendChild(t); });
  var va = document.getElementById('variantArea'); va.innerHTML='';
  if(p.variants && p.variants.length>0){ p.variants.forEach((v,idx)=>{ var b=document.createElement('button'); b.className='ghost'; b.textContent=v.name; b.onclick=function(){ selectVariant(idx); }; va.appendChild(b); }); }
  renderReviews(p.id);
  document.getElementById('modal').style.display='flex';
}
function closeModal(){ document.getElementById('modal').style.display='none'; currentProduct=null; document.getElementById('reviewText').value=''; document.getElementById('reviewFile').value=''; }
function selectVariant(idx){ if(!currentProduct) return; var v=currentProduct.variants[idx]; document.getElementById('mPrice').innerText = '₹'+v.price; document.getElementById('mStock').innerText = v.stock>0?('In stock: '+v.stock):'Out of stock'; }

function quickAdd(id){ var p=PRODUCTS.find(x=>x.id===id); if(!p||p.stock<=0){ alert('Out of stock'); return; } var it=CART.find(x=>x.id===id); if(it){ if(it.qty+1>p.stock){ alert('Not enough stock'); return; } it.qty+=1; } else CART.push({id:id,qty:1}); saveAll(); renderCart(); toast('Added to cart'); }
function addToCart(id,qty=1){ var p=PRODUCTS.find(x=>x.id===id); if(!p||p.stock<=0){ alert('Out of stock'); return; } var it=CART.find(x=>x.id===id); if(it){ if(it.qty+qty>p.stock){ alert('Not enough stock'); return; } it.qty+=qty; } else CART.push({id:id,qty:qty}); saveAll(); renderCart(); toast('Added to cart'); }
function renderCart(){ var el=document.getElementById('cartList'); el.innerHTML=''; if(CART.length===0){ el.innerHTML='<div class="small">Cart empty</div>'; document.getElementById('cartSummary').innerHTML=''; updateCounts(); return; } var total=0; CART.forEach(it=>{ var p=PRODUCTS.find(x=>x.id===it.id); var row=document.createElement('div'); row.style.display='flex'; row.style.justifyContent='space-between'; row.style.padding='8px 0'; row.innerHTML = `<div><strong>${p.title}</strong><div class="small">${p.cat} • ₹${p.price}</div></div><div><div><button class="ghost" onclick="changeQty(${p.id},-1)">-</button> <span style="margin:0 8px">${it.qty}</span> <button class="ghost" onclick="changeQty(${p.id},1)">+</button></div><div style="margin-top:6px"><button class="ghost" onclick="removeFromCart(${p.id})">Remove</button></div></div>`; el.appendChild(row); total+=p.price*it.qty; }); var gst=Math.round(total*0.18); var final=total+gst-(APPLIED?APPLIED.amount:0); document.getElementById('cartSummary').innerHTML=`<div class="small">Subtotal: ₹${total} • GST(18%): ₹${gst} • Discount: ₹${APPLIED?APPLIED.amount:0} • <strong style="color:#86efac">Payable: ₹${final}</strong></div>`; updateCounts(); }
function changeQty(id,delta){ var it=CART.find(x=>x.id===id); if(!it) return; var p=PRODUCTS.find(x=>x.id===id); var newq=Math.max(1,it.qty+delta); if(newq>p.stock){ alert('Not enough stock'); return; } it.qty=newq; saveAll(); renderCart(); }
function removeFromCart(id){ CART=CART.filter(x=>x.id!==id); saveAll(); renderCart(); }

function toggleWish(id){ if(WISHLIST.includes(id)){ WISHLIST=WISHLIST.filter(x=>x!==id); toast('Removed from wishlist'); } else { WISHLIST.push(id); toast('Added to wishlist'); } saveAll(); renderWishlist(); }
function renderWishlist(){ var el=document.getElementById('wishlistGrid'); el.innerHTML=''; if(WISHLIST.length===0){ el.innerHTML='<div class="small card">Wishlist empty</div>'; return; } WISHLIST.forEach(id=>{ var p=PRODUCTS.find(x=>x.id===id); var d=document.createElement('div'); d.className='card'; d.innerHTML = `<div class='imgwrap' style='height:140px'><img src='${p.imgs[0]}' style='width:100%;height:100%;object-fit:cover'/></div><h4 style='margin-top:8px'>${p.title}</h4><div style='display:flex;gap:8px'><button class='btn' onclick='addToCart(${p.id}); toggleWish(${p.id})'>Add</button><button class='ghost' onclick='toggleWish(${p.id})'>Remove</button></div>`; el.appendChild(d); }); }

function renderReviews(pid){ var list = REVIEWS[pid] || []; var el=document.getElementById('reviewsList'); el.innerHTML=''; if(list.length===0){ el.innerHTML='<div class="small">No reviews yet</div>'; return; } list.forEach(r=>{ var d=document.createElement('div'); d.style.borderTop='1px solid #12202a'; d.style.padding='8px 0'; d.innerHTML=`<div style="font-weight:700">${r.name||'Customer'} <span class="small">• ${r.rating}★</span></div><div class="small">${r.text}</div>${r.img?'<div style="margin-top:6px"><img src="'+r.img+'" style="width:160px;border-radius:6px"/></div>':''}`; el.appendChild(d); }); }
function submitReview(){ if(!currentProduct) return; var txt=document.getElementById('reviewText').value.trim(); var f=document.getElementById('reviewFile'); if(!txt){ alert('Write review'); return; } if(f.files && f.files[0]){ var reader=new FileReader(); reader.onload=function(e){ saveReview(currentProduct.id, txt, e.target.result); }; reader.readAsDataURL(f.files[0]); } else { saveReview(currentProduct.id, txt, null); } document.getElementById('reviewText').value=''; document.getElementById('reviewFile').value=''; }
function saveReview(pid, text, img){ var list = REVIEWS[pid] || []; list.unshift({name:'Customer',rating:5,text:text,img:img,date:Date.now()}); REVIEWS[pid]=list; localStorage.setItem('bhet_reviews', JSON.stringify(REVIEWS)); renderReviews(pid); toast('Review submitted'); }

function applyCoupon(){ var code=document.getElementById('coupon').value.trim(); if(!code) return alert('Enter coupon'); var c=COUPONS.find(x=>x.code===code); if(!c) return alert('Invalid coupon'); APPLIED=c; renderCart(); toast('Coupon applied'); }

async function checkoutWhatsApp(){
  // attempt to persist order to Firestore/localStorage
  try{ const order = { items: CART, total: CART.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + (p? p.price* i.qty:0); },0), createdAt: Date.now() }; sendOrderToFirestore(order); }catch(e){}
 if(CART.length===0){ var msg=encodeURIComponent(document.getElementById('enquiry').value||'Hello, I want to enquire.'); window.open('https://wa.me/917768082083?text='+msg,'_blank'); return; } var lines=['Order from BHET:']; var total=0; CART.forEach(it=>{ var p=PRODUCTS.find(x=>x.id===it.id); lines.push(p.title+' x '+it.qty+' = ₹'+(p.price*it.qty)); total+=p.price*it.qty; }); lines.push('Subtotal: ₹'+total); var gst=Math.round(total*0.18); lines.push('GST(18%): ₹'+gst); if(APPLIED) lines.push('Discount: ₹'+APPLIED.amount); lines.push('Payable: ₹'+(total+gst-(APPLIED?APPLIED.amount:0))); var txt=encodeURIComponent(lines.join('\n')); window.open('https://wa.me/917768082083?text='+txt,'_blank'); saveAll(); toast('Checkout started'); }

/* Admin login & password change */
document.addEventListener('keydown', function(e){ if(e.shiftKey && e.key && e.key.toLowerCase()==='a'){ document.getElementById('admin-login').style.display='flex'; } });
function closeAdminLogin(){ document.getElementById('admin-login').style.display='none'; }
function doAdminLogin(){ var id=document.getElementById('adminId').value.trim(); var pass=document.getElementById('adminPass').value.trim(); var ADMIN_ID=localStorage.getItem('bhet_admin_id')||'bhet'; var ADMIN_PASS=localStorage.getItem('bhet_admin_pass')||'7768082083'; if(id===ADMIN_ID && pass===ADMIN_PASS){ localStorage.setItem('bhet_admin','loggedin'); window.open('admin.html','_blank'); closeAdminLogin(); } else alert('Invalid'); }

function changeAdminPassword(){ var old=document.getElementById('oldPass').value.trim(); var nw=document.getElementById('newPass').value.trim(); var cn=document.getElementById('confirmPass').value.trim(); var saved=localStorage.getItem('bhet_admin_pass')||'7768082083'; if(old!==saved){ alert('Old password incorrect'); return; } if(nw!==cn){ alert('Passwords do not match'); return; } localStorage.setItem('bhet_admin_pass', nw); toast('Password updated'); closeChangePass(); }
function closeChangePass(){ document.getElementById('changePassBox').style.display='none'; }

function logoutAdmin(){ localStorage.removeItem('bhet_admin'); toast('Logged out'); }

/* Delivery estimator simple */
function estimateDelivery(pin){ if(!pin) return 'Enter PIN'; if(pin.toString().startsWith('443')) return 'Delivery: 2-3 days'; return 'Delivery: 5-7 days'; }

/* init */
populateCats(); renderProducts(); renderWishlist(); renderCart(); updateCounts();

/* register service worker */
if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
</script>

<script>
// If Firebase is enabled, try load products from Firestore collection 'products' and replace local PRODUCTS
async function tryLoadProductsFromFirestore(){
  if(window.__USE_FIREBASE__ && window.__FB){
    try{
      const { db, collection, getDocs } = window.__FB;
      const q = await getDocs(collection(db, 'products'));
      const prods = q.docs.map(d=>({ id: d.id, ...d.data() }));
      if(prods && prods.length>0){
        // normalize IDs to numbers if possible
        prods.forEach(p=>{ if(!p.id && p.id!==0) p.id = Date.now()+Math.floor(Math.random()*1000); });
        localStorage.setItem('BHET_products', JSON.stringify(prods));
        console.info('Products loaded from Firestore, saved to localStorage');
        if(typeof renderProducts === 'function') renderProducts();
      }
    }catch(e){ console.warn('Firestore load failed', e); }
  }
}
// Hook into page after load
window.addEventListener('load', ()=>{ tryLoadProductsFromFirestore(); });
// Function to send orders to Firestore
async function sendOrderToFirestore(order){
  if(window.__USE_FIREBASE__ && window.__FB){
    try{
      const { db, collection, addDoc } = window.__FB;
      const docRef = await addDoc(collection(db, 'orders'), order);
      console.info('Order stored in Firestore', docRef.id);
      return {ok:true, id: docRef.id};
    }catch(e){ console.warn('Order write failed', e); return {ok:false, error:e}; }
  } else {
    // fallback to localStorage orders
    const o = JSON.parse(localStorage.getItem('BHET_orders')||'[]');
    o.push(order); localStorage.setItem('BHET_orders', JSON.stringify(o)); return {ok:true, id: o.length};
  }
}
// The site's existing checkout function (checkoutWhatsApp) will call sendOrderToFirestore(order) before opening WhatsApp if you want server persistence.
// Example usage: sendOrderToFirestore({phone:'7768082083', items:[...], total:1234, createdAt:Date.now()});
</script>

</body>
</html>
